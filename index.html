﻿<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=UTF-8"><meta http-equiv="Content-Language" content="zh-cn"><meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1.0, maximum-scale=1.0"/><title>玻璃幕墙光反射影响预测工具</title>
<script src="jquery-1.10.2.min.js"></script>
<script src="jquery-ui-1.10.3.custom.min.js"></script><link rel="stylesheet" type="text/css" href="jquery-ui-1.10.3.custom.min.css">
<script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?key=AIzaSyC8mjYLDLdDSwJJsEzJNKCCGiE_R2RzyK0&sensor=true"></script>
<script src="d3.v3.min.js"></script>
<style>body{background-color:#fbf8ef;font-family:'Helvetica Neue',HelveticaNeue,Helvetica,Arial,sans-serif;margin:1em 2em}
h1{color:#0b3861;font-family:'Droid Sans Fallback',STHeiTi,微软雅黑,黑体,SimHei,sans-serif;font-size:1.5em;margin-top:0}
h2{font-size:1.25em}p{margin:.5em 0}#map-canvas{height:500px;width:70%}#tools{clear:right;float:right;width:25%}
#chart-svg{height:400px;width:80%}#chart-legend{clear:right;float:right;width:23%}
.wigtitle{color:#61380b;font-weight:bold}.slider{margin:0 15px;width:80%}.jquibt{font-size:.8em}
.jqui{font-size:12px}.info{border-bottom:1px #38C solid;margin-bottom:2em}.num{color:#175086}
#simplesearch{background-color:#f9f9f9;border:solid 1px #ddd;border-radius:4px;color:#000;display:block;height:1.75em;margin-top:.65em;position:relative;width:85%}
#simplesearch #address{background-color:transparent;border:0;font-size:14px;height:90%;left:0;margin:0;outline:0;padding:.2em 0 .2em 1em;position:absolute;top:5%;width:90%}
#simplesearch #searchbutton{background-color:transparent;border:0;margin:0;padding:.3em .4em .2em 0;position:absolute;right:0;top:10%;width:10%}
#simplesearch #searchbutton>img{border:0;margin:0;padding:0;vertical-align:middle}
#radio{margin-top:.4em}label[for^=radio] span:before{content:"";height:1em;left:.5em;position:absolute;top:.5em;width:.5em}
label[for=radio1] span:before{background-color:#ff8000}label[for=radio2] span:before{background-color:#a5df00}
label.forrad span{text-indent:.5em}#button{margin:2em 1em}#error{display:none;font-size:.8em;position:absolute}
a,a:visited{color:#03E;text-decoration:none}#footer{border-top:1px #EEE solid;font-size:.5em;margin:2em;padding-top:1em;text-align:center}
.axis path,.axis line{fill:none;shape-rendering:crispEdges;stroke:#000}</style>
<script>
var map,markera,markerb,markerc,markerd,geocoder,visiblemark=!1,Palette="#9edae5 #55FF55 #1f77b4 #e377c2 #ff7f0e #d62728".split(" "),efname="无 可接受 轻微影响 有影响 强影响 严重影响".split(" "),dearth=12745594,pi180=0.0174532925199,w=0.75*$(document.body).width(),h=400,padding=32,timeoutID=-1;
function initialize(){var a={zoom:12,center:new google.maps.LatLng(31.231,121.474),mapTypeId:google.maps.MapTypeId.ROADMAP,streetViewControl:!1};geocoder=new google.maps.Geocoder;google.maps.visualRefresh=!0;map=new google.maps.Map(document.getElementById("map-canvas"),a);markera=new google.maps.Marker({position:map.getCenter(),map:map,title:"A",visible:!1,draggable:!0});markerb=new google.maps.Marker({position:map.getCenter(),map:map,title:"B",visible:!1,draggable:!0});markerc=new google.maps.Marker({position:map.getCenter(),
map:map,title:"C",visible:!1,draggable:!0});markerd=new google.maps.Marker({position:map.getCenter(),map:map,title:"D",visible:!1,draggable:!0});var d=new google.maps.Polyline({path:[markera.getPosition(),markerb.getPosition()],map:map,strokeColor:"#FF8000",strokeOpacity:1,strokeWeight:3,visible:!1}),c=new google.maps.Polyline({path:[markera.getPosition(),markerb.getPosition()],map:map,strokeColor:"#A5DF00",strokeOpacity:1,strokeWeight:3,visible:!1});google.maps.event.addListener(map,"click",function(a){"wa"==
$("[name='radio']:checked").val()?markera.getVisible()?markerb.getVisible()?(markera.setPosition(a.latLng),d.setPath([markera.getPosition(),markerb.getPosition()])):(markerb.setPosition(a.latLng),markerb.setVisible(!0),d.setPath([markera.getPosition(),markerb.getPosition()]),d.setVisible(!0)):(markera.setPosition(a.latLng),markera.setVisible(!0)):markerc.getVisible()?markerd.getVisible()?(markerc.setPosition(a.latLng),c.setPath([markerc.getPosition(),markerd.getPosition()])):(markerd.setPosition(a.latLng),
markerd.setVisible(!0),c.setPath([markerc.getPosition(),markerd.getPosition()]),c.setVisible(!0),visiblemark=!0):(markerc.setPosition(a.latLng),markerc.setVisible(!0),visiblemark=!0)});google.maps.event.addListener(map,"rightclick",function(a){"wa"==$("[name='radio']:checked").val()?(markerb.setPosition(a.latLng),d.setPath([markera.getPosition(),markerb.getPosition()])):(markerd.setPosition(a.latLng),c.setPath([markerc.getPosition(),markerd.getPosition()]))});google.maps.event.addListener(markera,
"position_changed",function(){d.setPath([markera.getPosition(),markerb.getPosition()]);$("#distance").text(dist());AutoRedraw()});google.maps.event.addListener(markerb,"position_changed",function(){d.setPath([markera.getPosition(),markerb.getPosition()]);$("#distance").text(dist());AutoRedraw()});google.maps.event.addListener(markerc,"position_changed",function(){c.setPath([markerc.getPosition(),markerd.getPosition()]);$("#distanceb").text(distb());AutoRedraw()});google.maps.event.addListener(markerd,
"position_changed",function(){c.setPath([markerc.getPosition(),markerd.getPosition()]);$("#distanceb").text(distb());AutoRedraw()});$("#radiogroup").change(function(){"wa"==$("[name='radio']:checked").val()?(markera.setVisible(!0),markerb.setVisible(!0),markerc.setVisible(!1),markerd.setVisible(!1),d.setVisible(!0)):(markera.setVisible(!1),markerb.setVisible(!1),visiblemark&&(markerc.setVisible(!0),markerd.setVisible(!0),c.setVisible(!0)))})}
function codeAddress(){var a=document.getElementById("address").value;""!=a&&geocoder.geocode({address:a,latLng:map.getCenter()},function(a,c){c==google.maps.GeocoderStatus.OK?(map.panTo(a[0].geometry.location),markera.setPosition(map.getCenter()),markerb.setPosition(map.getCenter()),markerc.setPosition(map.getCenter()),markerd.setPosition(map.getCenter())):($("#errdiv p").text(function(){if(c==google.maps.GeocoderStatus.ZERO_RESULTS)return"找不到地址。";if(c==google.maps.GeocoderStatus.OVER_QUERY_LIMIT)return"超出配额。";
if(c==google.maps.GeocoderStatus.REQUEST_DENIED)return"请求被拒绝。";if(c==google.maps.GeocoderStatus.INVALID_REQUEST)return"缺少查询内容。"}),$("#error").show(),$("#error").delay(5E3),$("#error").fadeOut(500))})}
function dist(){var a=markera.getPosition().lat()*pi180,d=markera.getPosition().lng()*pi180,c=markerb.getPosition().lat()*pi180,e=markerb.getPosition().lng()*pi180,a=Math.sqrt(Math.pow(Math.sin(c)-Math.sin(a),2)+Math.pow(Math.cos(c)-Math.cos(a)*Math.cos(Math.abs(d-e)),2)+Math.pow(Math.cos(a)*Math.sin(Math.abs(d-e)),2)),a=Math.round(100*dearth*Math.asin(a/2))/100;500<a?$("#distance").css("color","red"):$("#distance").css("color","#175086");return a}
function distb(){var a=markerc.getPosition().lat()*pi180,d=markerc.getPosition().lng()*pi180,c=markerd.getPosition().lat()*pi180,e=markerd.getPosition().lng()*pi180,a=Math.sqrt(Math.pow(Math.sin(a)-Math.sin(a),2)+Math.pow(Math.cos(c)-Math.cos(a)*Math.cos(Math.abs(d-e)),2)+Math.pow(Math.cos(a)*Math.sin(Math.abs(d-e)),2)),a=Math.round(100*dearth*Math.asin(a/2))/100;500<a?$("#distanceb").css("color","red"):$("#distanceb").css("color","#175086");return a}
function Calc(a,d,c,e,b,r,k,s,p,l){var f=(c+b+k+p)/4;d+=((e+r+s+l)/4/pi180-120)/15;a=2*Math.PI*(a-1)/365;a=0.006918-0.399912*Math.cos(a)+0.070257*Math.sin(a)-0.006758*Math.cos(2*a)+9.07E-4*Math.sin(2*a)-0.002697*Math.cos(3*a)+0.00148*Math.sin(3*a);a=Math.asin(Math.cos(15*Math.PI*(d-12)/180)*Math.cos(f)*Math.cos(a)+Math.sin(f)*Math.sin(a));if(0<a)f=0-Math.asin(-Math.sin(15*Math.PI*(d-12)/180)*Math.cos(f)/Math.cos(a)),n=0!=c-b?Math.abs(b-c)/(b-c)*Math.acos(Math.asin(Math.sqrt(Math.pow(Math.sin(b)-Math.sin(c),
2)+Math.pow(Math.cos(b)-Math.cos(c),2))/2)/Math.asin(Math.sqrt(Math.pow(Math.sin(b)-Math.sin(c),2)+Math.pow(Math.cos(b)-Math.cos(c)*Math.cos(Math.abs(e-r)),2)+Math.pow(Math.cos(c)*Math.sin(Math.abs(e-r)),2))/2)):0,m=0!=k-p?Math.abs(p-k)/(p-k)*Math.acos(Math.asin(Math.sqrt(Math.pow(Math.sin(p)-Math.sin(k),2)+Math.pow(Math.cos(p)-Math.cos(k),2))/2)/Math.asin(Math.sqrt(Math.pow(Math.sin(p)-Math.sin(k),2)+Math.pow(Math.cos(p)-Math.cos(k)*Math.cos(Math.abs(s-l)),2)+Math.pow(Math.cos(k)*Math.sin(Math.abs(s-
l)),2))/2)):0,gamma=Math.PI/2-m+2*n-f,theta=Math.acos(Math.abs(Math.cos(gamma)*Math.cos(a))),B=20550*Math.exp(-0.223/Math.sin(a))/Math.PI;else return-1;if(theta<Math.PI/12){if(2E3<=B)return 5}else if(theta>=Math.PI/12&&theta<=Math.PI/6){if(2E3<=B&&4E3>B)return 2;if(4E3<=B&&6E3>B)return 3;if(6E3<=B)return 4}else if(theta>Math.PI/6)return 1;return 0}
function AutoRedraw(){$("#autocalc").is(":checked")&&visiblemark&&(-1!=timeoutID&&clearTimeout(timeoutID),DrawChart(3,5),timeoutID=setTimeout("DrawChart(1,1);timeoutID=-1",2E3))}
function DrawChart(a,d){var c=Array(7);for(i=0;7>i;i++)c[i]=[[]];var e=Array(7);for(i=0;7>i;i++)e[i]=[[]];alat=markera.getPosition().lat()*pi180;alng=markera.getPosition().lng()*pi180;blat=markerb.getPosition().lat()*pi180;blng=markerb.getPosition().lng()*pi180;clat=markerc.getPosition().lat()*pi180;clng=markerc.getPosition().lng()*pi180;dlat=markerd.getPosition().lat()*pi180;dlng=markerd.getPosition().lng()*pi180;var b=Math.sqrt(Math.pow(Math.sin((clat+dlat)/2)-Math.sin((alat+blat)/2),2)+Math.pow(Math.cos((clat+
dlat)/2)-Math.cos((alat+blat)/2)*Math.cos(Math.abs((alng+blng)/2-(clng+dlng)/2)),2)+Math.pow(Math.cos((alat+blat)/2)*Math.sin(Math.abs((alng+blng)/2-(clng+dlng)/2)),2)),r=Math.round(100*dearth*Math.asin(b/2))/100;$("#grapharea").empty();if(1500<r||500<dist()||500<distb())return 0;var k=d3.scale.linear().domain([0,1439]).range([padding,w-2*padding]),s=d3.scale.linear().domain([0,364]).range([h-padding,padding]),r=d3.select("#grapharea"),p=d3.svg.line().x(function(a){return k(a[0])}).y(function(a){return s(a[1])}).interpolate("linear-closed"),
l=b=-1,f=[0,0,0,0,0,0],g=[0,0,0,0,0,0],q=[[],[],[],[],[],[]],t=[[],[],[],[],[],[]];for(i=l=0;365>i;i+=d){q=[[],[],[],[],[],[]];t=[[],[],[],[],[],[]];b=-1;for(j=0;1440>j;j+=a)l=Calc(i,j/60,alat,alng,blat,blng,clat,clng,dlat,dlng),b!=l&&(-1!=b&&t[b].push(j-0.5),-1!=l&&q[l].push(j-0.5)),b=l;for(j=0;6>j;j++){if(q[j].length!=f[j]){l=f[j]+q[j].length;0<i&&(g[j]+=f[j]);for(b=0;b<l;b++)c[j].push([]),e[j].push([])}if(q[j].length!=f[j]&&0<g[j]){if(0<e[j][g[j]-1].length){for(b=0;b<f[j];b++)c[j][g[j]-f[j]+b][c[j][g[j]-
f[j]+b].length-1][1]+=d/2,e[j][g[j]-f[j]+b][e[j][g[j]-f[j]+b].length-1][1]+=d/2;for(b=0;b<q[j].length;b++)c[j][g[j]+b].push([q[j][b],i-d/2]),e[j][g[j]+b].push([t[j][b],i-d/2])}}else for(b=0;b<q[j].length;b++)c[j][g[j]+b].push([q[j][b],i]),e[j][g[j]+b].push([t[j][b],i]);f[j]=q[j].length}}for(i=0;6>i;i++)for(j=0;j<c[i].length;j++)c[i][j]=c[i][j].concat(e[i][j].reverse()),1<c[i][j].length&&r.append("path").attr("d",p(c[i][j])).attr("fill",Palette[i]).attr("stroke",Palette[i]).attr("stroke-width",1);
c=new Date;e=new Date(c.getFullYear(),0,0);r.append("circle").attr("cx",k(60*c.getHours()+c.getMinutes())).attr("cy",s(Math.floor((c-e)/864E5))).attr("r",2).attr("fill","#0B3861")}
$(document).ready(function(){initialize();$("#wallh").slider({orientation:"horizontal",range:"min",max:120,value:20,slide:function(a,b){$("#wallh-n").text(b.value)},change:function(a,b){$("#wallh-n").text(b.value)}});$("#planeh").slider({orientation:"horizontal",range:"min",max:100,value:10,slide:function(a,b){$("#planeh-n").text(b.value)},change:function(a,b){$("#planeh-n").text(b.value)}});$("#radio").buttonset();$("#btncalc").button();$("#autocalc").button();$("#btncalc").click(function(){visiblemark&&
(DrawChart(1,1),$("html, body").scrollTop($(document).height()))});var a=d3.scale.linear().domain([0,24]).range([padding,w-2*padding]),d=d3.scale.linear().domain([1,13]).range([h-padding,padding]),a=d3.svg.axis().scale(a).orient("bottom").ticks(24).tickFormat(function(a){return 24!=a?a:"小时"}),d=d3.svg.axis().scale(d).orient("left").ticks(12).tickFormat(function(a){return 13!=a?a:"月"}),c=d3.select("#chart-svg").append("svg").attr("width",w).attr("height",h);c.append("rect").attr("x",padding).attr("y",
padding).attr("width",w-3*padding).attr("height",h-2*padding).attr("fill","#F0F0F0");c.append("g").attr("class","axis ax").attr("transform","translate(0,"+(h-padding)+")").call(a);c.append("g").attr("class","axis ay").attr("transform","translate("+padding+",0)").call(d);c.append("g").attr("id","grapharea");a=d3.select("#chart-legend").append("svg").attr("width",0.2*$(document.body).width()).attr("height",h-100);a.selectAll("rect").data(Palette).enter().append("rect").attr("x",2).attr("y",function(a,
b){return 25*b}).attr("width",30).attr("height",20).attr("fill",function(a){return a});a.selectAll("text").data(efname).enter().append("text").attr("x",40).attr("y",function(a,b){return 25*b+16}).style("font-size","16px").text(function(a){return a});a.append("rect").attr("x",2).attr("y",150).attr("width",30).attr("height",20).attr("fill","#F0F0F0");a.append("text").attr("x",40).attr("y",166).style("font-size","16px").text("无日光");a.append("circle").attr("cx",17).attr("cy",185).attr("r",2).attr("fill",
"#0B3861");a.append("text").attr("x",40).attr("y",191).style("font-size","16px").text("当前时间")});
</script></head><body>
<!--[if lt IE 9]><div style="border: 1px solid #FF4000; background: #FFDA66; text-align: center; clear: both; height: 60px; position: relative;"><div style="position: absolute; right: 3px; top: 3px; font-family: Arial; font-weight: bold;"><a href="#" onclick='javascript:this.parentNode.parentNode.style.display="none"; return false;'>×</a></div>
<div style='margin: 0 auto; text-align: left; padding: 0; overflow: hidden; color: black; text-align:center'><p style="font-size: 14px; font-weight: bold; margin-top: 12px; text-align: center;">您正在使用一款过时的浏览器。网页可能无法使用。</p>
<p style="font-size: 12px; margin-top: 6px; line-height: 12px; text-align: center;">请升级您的浏览器（IE9及以上或其他浏览器）来获得更好的浏览体验。</p>
</div></div><![endif]-->
<h1>玻璃幕墙光反射影响预测工具</h1><div class="info"><p>在地图上通过左右键点击或移动标识来确定目标墙体的位置。</p><p>时区默认UTC+8时区（北京时间）。因为未考虑气候、地形、建筑实际结构、幕墙曲度、中间阻挡物等
，计算结果为预计最大值。计算结果仅供参考。</p></div><div id="app"><div id="tools"><form id="searchform" onsubmit="codeAddress();return false;"><div id="simpleSearch">
<input name="search" placeholder="查找地址" title="查找地址" id="address">
<button type="submit" name="button" title="查找地址" id="searchButton" onclick="codeAddress()">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAANCAAAAAC4QtCeAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAAJ0Uk5TAP9bkSK1AAAAaklEQVQI12P4///u3NrauXf/AwHD//05YLAfxLmbl7/n48c9+Xn3gZxJYDGg/BQgpyznC4jzJacMmVOMrgxowMFPnw5CDIAZnbMLxAFaWl09txrEY/gPAe87gTwY5//PmTmr4Jz/f699BgAmIHmp1XxJagAAAABJRU5ErkJggg==" alt="查找地址" width="12" height="13"></button></div></form><h2>计算设置</h2><p><form id="radiogroup">
<span class="wigtitle">更改地图上墙面：</span><div class="jquibt" id="radio">
<input type="radio" id="radio1" name="radio" value="wa" checked="checked"><label class="forrad" for="radio1">玻璃幕墙</label>
<input type="radio" id="radio2" name="radio" value="wb"><label class="forrad" for="radio2">受照射墙面</label></div></form></p><p><span class="wigtitle">玻璃幕墙宽：</span><span id="distance" class="num">0</span>米</p><p><span class="wigtitle">受照射墙宽：</span><span id="distanceb" class="num">0</span>米</p><p><span class="wigtitle">玻璃幕墙高度：</span><span id="wallh-n" class="num">20</span>米<div id="wallh" class="slider jqui"></div></p><p><span class="wigtitle">受照射面高度：</span><span id="planeh-n" class="num">10</span>米<div id="planeh" class="slider jqui"></div></p><p><div class="jquibt" id="button">
<button id="btncalc" name="button" title="绘图更精确">计算</button>
<input type="checkbox" id="autocalc" name="autocalc" checked="checked"><label for="autocalc">自动计算</label></div></p><div class="ui-widget" id="errdiv"><div class="ui-state-highlight ui-corner-all" style="padding:0 .7em" id="error"><p></p></div></div></div><div id="map-canvas"></div><div id="chart-legend"><h2>图例</h2><p><span class="wigtitle" style="background-color:#F0F0F0">空白</span>：位置不正确或无影响。</p></div><div id="chart-svg"></div></div><div id="footer">
制作：……</div></body></html>